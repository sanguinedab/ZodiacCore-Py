from sqlalchemy import select, func

from zodiac_core.db.repository import BaseSQLRepository

from app.infrastructure.database.models.item_model import ItemModel


class ItemRepository(BaseSQLRepository):
    async def get_by_id(self, item_id: int) -> ItemModel | None:
        async with self.session() as session:
            stmt = select(ItemModel).where(ItemModel.id == item_id)
            result = await session.execute(stmt)
            return result.scalar_one_or_none()

    async def count_all(self) -> int:
        async with self.session() as session:
            stmt = select(func.count()).select_from(ItemModel)
            result = await session.execute(stmt)
            return result.scalar_one() or 0

    async def get_page(self, offset: int, limit: int) -> list[ItemModel]:
        async with self.session() as session:
            stmt = select(ItemModel).order_by(ItemModel.id).offset(offset).limit(limit)
            result = await session.execute(stmt)
            return list(result.scalars().all())

